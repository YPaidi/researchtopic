<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Research Topic Picker</title>
  <meta name="description" content="Select interests, rate skills and constraints. We’ll rank topics and explain the fit clearly." />
  <style>
    :root{
      --bg:#f7fafc;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#1f2937;
      --primary:#4f46e5;
      --primary-weak:#eef2ff;
      --ok:#059669;
      --warn:#b45309;
      --bad:#b91c1c;
      --chip:#e5e7eb;
      --chip-text:#111827;
      --chip-selected:#4f46e5;
      --chip-selected-text:#fff;
      --ring: rgba(79,70,229,.35);
      --border:#e5e7eb;
      --shadow: 0 8px 24px rgba(17,24,39,.06);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    a{color:var(--primary)}
    .container{max-width:1080px;margin:0 auto;padding:32px 20px 96px}
    h1{font-size:34px;margin:0 0 6px}
    .sub{color:var(--muted);margin:0 0 26px}
    .section{margin:26px 0}
    .section h2{font-size:18px;margin:0 0 10px}
    .group{margin:18px 0}
    .group .label{font-weight:700;margin:0 0 10px}
    .chips{display:flex;flex-wrap:wrap;gap:10px}
    button.chip{
      appearance:none;border:none;margin:0;padding:8px 12px;border-radius:999px;
      background:var(--chip); color:var(--chip-text); cursor:pointer; font-size:14px; line-height:1;
      transition:transform .05s ease, background .2s ease, box-shadow .2s ease;
    }
    button.chip:hover{transform:translateY(-1px)}
    button.chip[aria-pressed="true"]{
      background:var(--chip-selected); color:var(--chip-selected-text);
      box-shadow:0 0 0 4px var(--ring);
    }
    .actions{display:flex;gap:12px;align-items:center}
    .linky{background:none;border:none;color:var(--primary);cursor:pointer;font-size:14px;padding:0}
    .cards{display:grid;grid-template-columns:1fr;gap:16px;margin-top:18px}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px;
      box-shadow:var(--shadow)
    }
    .titleRow{display:flex;align-items:flex-start;gap:12px}
    .rank{min-width:28px;height:28px;border-radius:999px;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
    .card h3{margin:0;font-size:18px}
    .desc{color:var(--muted);margin:8px 0 10px}
    .pillRow{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:8px}
    .pill{background:#eef2f7;border-radius:10px;padding:6px 10px;font-size:12px;border:1px solid var(--border)}
    .grid3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:8px}
    .box{background:#fafafa;border:1px dashed var(--border);border-radius:10px;padding:10px}
    .fit{font-weight:700}
    .fit.good{color:var(--ok)} .fit.mid{color:var(--warn)} .fit.bad{color:var(--bad)}
    .suit{background:#f5f7ff;border:1px solid #e0e7ff;border-radius:10px;padding:12px;margin-top:10px;color:#1e2b6b}
    .footer{margin-top:40px;color:var(--muted);text-align:center}
    .row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    .sliderRow{display:grid;grid-template-columns:1fr 160px;align-items:center;gap:14px}
    input[type="range"]{width:100%}
    .badge{display:inline-flex;align-items:center;gap:8px}
    .small{font-size:12px;color:var(--muted)}
    .divider{height:1px;background:var(--border);margin:18px 0}
    @media (min-width:900px){ .cards{grid-template-columns:1fr 1fr} }
  </style>
</head>
<body>
  <div class="container">
    <h1>Research Topic Picker</h1>
    <p class="sub">Select your interests, rate your skills and practical constraints. We’ll rank topics and explain the fit clearly.</p>

    <!-- Interests -->
    <div class="section" id="interestsSection">
      <div class="row">
        <h2 style="margin:0">Select Interests</h2>
        <div class="small">Choose 2–4 to start. You can always add more.</div>
        <div style="flex:1"></div>
        <button id="clearAll" class="linky" type="button">Clear all</button>
      </div>

      <div id="interestGroups"></div>
    </div>

    <div class="divider"></div>

    <!-- Skills -->
    <div class="section" id="skillsSection">
      <h2>Rate Your Current Skills</h2>
      <div class="small">0 = none, 4 = strong.</div>
      <div class="group" id="skillsForm"></div>
    </div>

    <div class="divider"></div>

    <!-- Constraints -->
    <div class="section" id="constraintsSection">
      <h2>Practical Constraints</h2>
      <div class="group">
        <div class="sliderRow">
          <label for="timeAvail"><strong>Weekly time available</strong></label>
          <div class="badge"><input id="timeAvail" type="range" min="1" max="5" step="1" value="3" /><span id="timeLabel">3 / 5</span></div>
        </div>
      </div>
      <div class="group row">
        <label class="badge"><input type="checkbox" id="hasTravel" checked/> Travel/access OK</label>
        <label class="badge"><input type="checkbox" id="hasEthics" checked/> Ethics/permissions OK</label>
      </div>
    </div>

    <div class="divider"></div>

    <!-- Results -->
    <div class="section">
      <div class="row">
        <h2 style="margin:0">Suggested Topics</h2>
        <div class="small" id="resultHint">Adjust anything—results update instantly.</div>
      </div>
      <div class="cards" id="results"></div>
    </div>

    <p class="footer">Developed by <strong>YatiPaidi</strong></p>
  </div>

  <script>
    // ---------- Interest catalogue (grouped chips) ----------
    const interestCatalogue = [
      {
        label: "Area Studies",
        tags: [
          "Chinese Studies (Malaysia)", "Japanese Studies (Malaysia)", "Korean Studies (Malaysia)",
          "East Asia (Comparative/Regional)", "Malaysia–East Asia Relations", "Japan", "China", "South Korea", "North Korea"
        ]
      },
      {
        label: "Methods",
        tags: [
          "Methods: Survey","Methods: Ethnography","Methods: Archival & Document Analysis",
          "Methods: Digital Humanities & GIS/Mapping","Methods: Computational Social Science","Methods: Quantitative/Statistics"
        ]
      },
      {
        label: "Language, Education & Society",
        tags: [
          "Language Education & Pedagogy","Language Policy & Planning","Writing Systems & Literacy",
          "Sociolinguistics","Youth, Education & Student Life","Overseas Chinese/Japanese/Korean Diasporas"
        ]
      },
      {
        label: "Media, Culture & Platforms",
        tags: [
          "Media, Journalism & Public Opinion","Popular Culture & Media","Digital Culture & Platforms","Arts, Literature & Aesthetics",
          "Tourism, Heritage Routes & Creative Industries"
        ]
      },
      {
        label: "Business, Economy & Work",
        tags: [
          "Business, Management & Work Culture","Economy & Development","Trade, FDI & Supply Chains",
          "Entrepreneurship & SMEs","Corporate Governance, CSR & ESG"
        ]
      },
      {
        label: "Politics, Law & International Relations",
        tags: [
          "Law, Governance & Public Policy","Politics, Elections & Civil Society","International Relations & Security",
          "Diplomacy, Soft Power & Cultural Exchange"
        ]
      },
      {
        label: "Society, Culture & Everyday Life",
        tags: ["Culture & Everyday Life","Gender, Sexuality & Family","Society & Social Change"]
      },
      {
        label: "Technology, Data & Environment",
        tags: ["Technology, Innovation & Industry 4.0","AI, Data Governance & Privacy","Environment, Climate & Energy Transitions"]
      },
      {
        label: "History, Heritage & Religion",
        tags: [
          "History (Modern & Contemporary)","History (Pre-modern)","Memory, Heritage & Museums",
          "Religion & Philosophy","Colonialism & Postcoloniality"
        ]
      },
      {
        label: "Comparative & Cross-Cutting",
        tags: ["Comparative & Cross-Cultural Studies","Demography, Migration & Diaspora"]
      }
    ];

    // ---------- UI state ----------
    const selectedInterests = new Set();
    const skills = ["literature","qualitative","quantitative","coding","fieldwork","writing","language","archival","dh"];
    const userSkills = Object.fromEntries(skills.map(k => [k,2]));
    let topics = [];

    // ---------- Render interest buttons ----------
    function renderInterestButtons(){
      const host = document.getElementById("interestGroups");
      host.innerHTML = "";
      interestCatalogue.forEach(group => {
        const wrap = document.createElement("div");
        wrap.className = "group";
        const lab = document.createElement("div");
        lab.className = "label";
        lab.textContent = group.label;
        wrap.appendChild(lab);

        const row = document.createElement("div");
        row.className = "chips";
        group.tags.forEach(tag => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "chip";
          btn.textContent = tag;
          btn.setAttribute("data-tag", tag);
          btn.setAttribute("aria-pressed", "false");
          btn.addEventListener("click", () => toggleInterest(btn, tag));
          btn.addEventListener("keydown", (e) => {
            if(e.key==="Enter"||e.key===" "){e.preventDefault(); toggleInterest(btn, tag);}
          });
          row.appendChild(btn);
        });
        wrap.appendChild(row);
        host.appendChild(wrap);
      });
    }

    function toggleInterest(btn, tag){
      if(selectedInterests.has(tag)){
        selectedInterests.delete(tag);
        btn.setAttribute("aria-pressed","false");
      }else{
        selectedInterests.add(tag);
        btn.setAttribute("aria-pressed","true");
      }
      scoreAndRender();
    }

    // ---------- Render skill sliders ----------
    function renderSkillSliders(){
      const host = document.getElementById("skillsForm");
      host.innerHTML = "";
      skills.forEach(k=>{
        const row = document.createElement("div");
        row.className = "sliderRow";
        const label = document.createElement("label");
        label.setAttribute("for","s_"+k);
        label.innerHTML = `<strong>${titleCase(k)}</strong>`;
        const right = document.createElement("div");
        right.className = "badge";
        const slider = document.createElement("input");
        slider.type="range"; slider.min="0"; slider.max="4"; slider.step="1"; slider.value = userSkills[k];
        slider.id = "s_"+k;
        const out = document.createElement("span");
        out.textContent = userSkills[k]+" / 4";
        slider.addEventListener("input", e => { userSkills[k] = +e.target.value; out.textContent = `${userSkills[k]} / 4`; scoreAndRender(); });
        right.appendChild(slider); right.appendChild(out);
        row.appendChild(label); row.appendChild(right);
        host.appendChild(row);
      });
    }

    // ---------- Constraints listeners ----------
    function bindConstraintControls(){
      const t = document.getElementById("timeAvail");
      const lab = document.getElementById("timeLabel");
      t.addEventListener("input", e => { lab.textContent = `${e.target.value} / 5`; scoreAndRender(); });
      document.getElementById("hasTravel").addEventListener("change", scoreAndRender);
      document.getElementById("hasEthics").addEventListener("change", scoreAndRender);
      document.getElementById("clearAll").addEventListener("click", ()=>{
        selectedInterests.clear();
        document.querySelectorAll('button.chip[aria-pressed="true"]').forEach(b=>b.setAttribute("aria-pressed","false"));
        scoreAndRender();
      });
    }

    // ---------- Suitability line (as requested) ----------
    function suitabilityLine(score) {
      const s = Math.round(score.finalScore);
      const interestPart = score.interestScore >= 80
        ? "matches your interests very well"
        : score.interestScore >= 50
        ? "partially matches your interests"
        : "has limited overlap with your interests";

      const skillPart = score.capabilityScore >= 80
        ? "your current skills are well aligned"
        : score.capabilityScore >= 50
        ? "you may need to polish some key skills"
        : "you will need significant upskilling";

      const feasibilityPart = score.constraintsScore >= 80
        ? "and it is feasible within your time and access"
        : score.constraintsScore >= 50
        ? "and it is likely feasible with careful planning"
        : "and it will require more time or access to be feasible";

      return `Overall fit ${s}/100 — this topic ${interestPart}; ${skillPart}, ${feasibilityPart}.`;
    }

    // ---------- Scoring ----------
    function scoreTopic(t){
      // Interest score
      let interestScore = 50; // neutral default
      if(selectedInterests.size>0){
        const match = t.tags.filter(tag => selectedInterests.has(tag)).length;
        const denom = Math.max(1, Math.min(selectedInterests.size, 6)); // cap to avoid over-penalty
        interestScore = Math.min(100, Math.round((match/denom)*100));
      }

      // Capability score (how well user meets/approaches requirements)
      let have = 0, total = 0;
      for(const k of skills){
        const need = (t.skills && typeof t.skills[k]==="number") ? t.skills[k] : 0;
        const mine = userSkills[k] ?? 0;
        // give partial credit even if below need
        const credit = need===0 ? 1 : Math.min(1, mine/(need||1));
        have += credit; total += 1;
      }
      const capabilityScore = Math.round((have/total)*100);

      // Constraints score
      const timeAvail = +document.getElementById("timeAvail").value; // 1..5
      const timeDemand = t.timeDemand ?? 3; // 1..5 (5 heavy)
      let timeOK = Math.max(0, 1 - Math.max(0, (timeDemand - timeAvail))/4); // linear penalty
      let travelOK = (t.needs && t.needs.travel) ? (document.getElementById("hasTravel").checked ? 1 : 0) : 1;
      let ethicsOK = (t.needs && t.needs.ethics) ? (document.getElementById("hasEthics").checked ? 1 : 0) : 1;
      const constraintsScore = Math.round(((timeOK + travelOK + ethicsOK) / 3) * 100);

      // Final
      const finalScore = Math.round(0.45*interestScore + 0.35*capabilityScore + 0.20*constraintsScore);
      return {interestScore, capabilityScore, constraintsScore, finalScore};
    }

    // ---------- Render results ----------
    function scoreAndRender(){
      if(!Array.isArray(topics) || topics.length===0) return;
      const results = document.getElementById("results");
      const ranked = topics.map(t => ({t, s: scoreTopic(t)}))
                           .sort((a,b)=>b.s.finalScore - a.s.finalScore)
                           .slice(0,12);
      results.innerHTML = "";
      ranked.forEach((row, i) => {
        const {t, s} = row;
        const card = document.createElement("div"); card.className="card";

        const titleRow = document.createElement("div"); titleRow.className="titleRow";
        titleRow.innerHTML = `<div class="rank">${i+1}</div><h3>${escapeHtml(t.title)}</h3>`;
        card.appendChild(titleRow);

        const desc = document.createElement("div"); desc.className="desc";
        desc.textContent = t.description || t.title;
        card.appendChild(desc);

        // tags
        const pills = document.createElement("div"); pills.className="pillRow";
        t.tags.forEach(tag=>{
          const p = document.createElement("span"); p.className="pill"; p.textContent = tag; pills.appendChild(p);
        });
        card.appendChild(pills);

        // triplet boxes
        const grid = document.createElement("div"); grid.className="grid3";
        grid.appendChild(boxMetric("Interests", s.interestScore));
        grid.appendChild(boxMetric("Capabilities", s.capabilityScore));
        grid.appendChild(boxMetric("Constraints", s.constraintsScore));
        card.appendChild(grid);

        const suit = document.createElement("div"); suit.className="suit"; suit.textContent = suitabilityLine(s);
        card.appendChild(suit);

        results.appendChild(card);
      });
    }

    function boxMetric(label, val){
      const b = document.createElement("div"); b.className="box";
      const cls = val>=80 ? "good" : val>=50 ? "mid" : "bad";
      b.innerHTML = `<div class="small">${label}</div><div class="fit ${cls}">${val} / 100</div>`;
      return b;
    }

    function titleCase(k){ return k.charAt(0).toUpperCase()+k.slice(1); }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // ---------- Init ----------
    async function init(){
      renderInterestButtons();
      renderSkillSliders();
      bindConstraintControls();
      try{
        const res = await fetch("topics.json",{cache:"no-store"});
        topics = await res.json();
      }catch(e){
        console.error("Failed to load topics.json", e);
        topics = [];
      }
      scoreAndRender();
    }
    init();
  </script>
</body>
</html>
