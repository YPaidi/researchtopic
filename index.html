<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Research Topic Picker — East Asia</title>
  <meta name="description" content="Select your interests, rate your skills & practical constraints. We’ll rank topics and explain the fit clearly." />

  <style>
    :root{
      --bg: #f7fafc;            /* light background */
      --panel: #ffffff;         /* cards / panels */
      --text: #0f172a;          /* main text */
      --muted: #475569;         /* muted text */
      --chip: #eef2ff;          /* chip idle */
      --chip-text: #3730a3;
      --chip-selected: #4338ca; /* chip selected bg */
      --chip-selected-text: #ffffff;
      --accent: #4f46e5;        /* controls */
      --ring: rgba(79,70,229,.25);
      --line: #e5e7eb;
      --good: #16a34a;
      --warn: #f59e0b;
      --bad:  #dc2626;
    }

    *{ box-sizing: border-box }
    html, body{ height:100% }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    .wrap{ max-width:1100px; margin:0 auto; padding:28px 20px 60px }

    h1{ font-size: clamp(28px, 3.2vw, 40px); margin: 0 0 6px }
    .sub{ color:var(--muted); margin:0 0 24px }

    /* section panels */
    .panel{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:18px;
      margin:14px 0;
      box-shadow: 0 2px 10px rgba(15,23,42,.04);
    }

    /* interest chips */
    .chip-row{ display:flex; flex-wrap:wrap; gap:10px; }
    .row-head{ font-weight:700; margin:22px 0 10px }
    button.chip{
      appearance:none; border:1px solid #c7d2fe; cursor:pointer;
      background:var(--chip); color:var(--chip-text);
      padding:8px 12px; border-radius:999px; font-weight:600; font-size:14px;
      transition: transform .05s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
    }
    button.chip:hover{ transform: translateY(-1px); box-shadow:0 6px 16px var(--ring); }
    /* selected / highlighted */
    button.chip[aria-pressed="true"],
    button.chip.selected{
      background:var(--chip-selected);
      color:var(--chip-selected-text);
      border-color: transparent;
      box-shadow: 0 0 0 4px var(--ring);
    }
    button.chip:focus-visible{ outline:3px solid var(--ring); outline-offset:2px }

    .controls-grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:14px }
    .ctrl{ background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:14px }
    .ctrl h3{ font-size:14px; margin:0 0 8px; color:var(--muted); text-transform:uppercase; letter-spacing:.04em }
    .slider-row{ display:flex; align-items:center; gap:12px; margin:6px 0 }
    .slider-row label{ flex: 0 0 170px }
    .slider-row output{ min-width: 32px; text-align:right; color:var(--muted) }
    input[type=range]{ width:100% }
    .checks{ display:flex; gap:16px; flex-wrap:wrap }
    .checks label{ display:flex; align-items:center; gap:8px }

    .bar{
      height:9px; background:#eef2f7; border-radius:999px; overflow:hidden; border:1px solid var(--line)
    }
    .bar > span{ display:block; height:100%; background: linear-gradient(90deg,var(--accent),#22c55e); }

    .result{ display:grid; grid-template-columns:1fr auto; gap:12px; align-items:baseline }
    .result h2{ margin:0; font-size:20px }
    .score{ font-weight:800; font-size:22px; color:var(--accent) }
    .tags{ display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 0 }
    .tag{ font-size:12px; padding:6px 10px; background:#f1f5f9; border:1px solid var(--line); border-radius:999px; color:#334155 }

    .suit-line{
      background:#f8fafc; border:1px dashed var(--line); border-radius:12px;
      padding:10px 12px; color:#334155
    }

    .row{ display:grid; grid-template-columns: 1fr; gap:10px }
    @media (min-width:720px){ .row{ grid-template-columns: repeat(3,1fr) } }

    .muted{ color:var(--muted) }
    .footer{ text-align:center; margin-top:26px; color:var(--muted) }
    .small{ font-size:12px }

    .btn-reset{ all:unset; }
    .btn{
      background: var(--accent); color:#fff; padding:10px 14px; border-radius:12px;
      border:none; cursor:pointer; font-weight:700;
      box-shadow: 0 6px 16px var(--ring);
    }
    .btn.secondary{
      background:#e2e8f0; color:#0f172a;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Research Topic Picker</h1>
    <p class="sub">Select your interests, rate your skills and practical constraints. We’ll rank topics and explain the fit clearly.</p>

    <!-- Interests -->
    <section class="panel" id="interestsPanel">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <h2 style="margin:0">Select Interests</h2>
        <button id="clearAll" class="btn secondary" type="button" title="Clear selected interests">Clear all</button>
      </div>
      <p class="muted small">Choose 2–4 to start. You can always add more.</p>

      <div id="interestGroups"></div>
    </section>

    <!-- Skills & Constraints -->
    <section class="controls-grid" aria-label="Skill and constraint inputs">
      <div class="ctrl">
        <h3>Skills (0–4)</h3>
        <div id="skillsSliders"></div>
      </div>
      <div class="ctrl">
        <h3>Practical Constraints</h3>
        <div class="slider-row">
          <label for="timeAvail"><strong>Time available</strong> (1 = very limited, 5 = ample)</label>
          <input id="timeAvail" type="range" min="1" max="5" step="1" value="3" />
          <output id="timeOut">3</output>
        </div>
        <div class="checks">
          <label><input id="travelOk" type="checkbox" /> I can travel if needed</label>
          <label><input id="ethicsOk" type="checkbox" /> I can obtain ethics/consent if needed</label>
        </div>
      </div>
    </section>

    <!-- Results -->
    <section class="panel" id="resultsPanel">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <h2 style="margin:0">Suggested Topics</h2>
        <span class="muted small">Sorted by overall fit</span>
      </div>
      <div id="results"></div>
    </section>

    <p class="footer small">Developed by <strong>YatiPaidi</strong></p>
  </div>

  <script>
    // ---------- Interest catalogue (grouped as chips) ----------
    const INTEREST_GROUPS = {
      "Area Studies": [
        "Chinese Studies (Malaysia)", "Japanese Studies (Malaysia)", "Korean Studies (Malaysia)",
        "East Asia (Comparative/Regional)", "Malaysia–East Asia Relations",
        "Japan", "China", "South Korea", "North Korea"
      ],
      "Methods": [
        "Methods: Survey","Methods: Ethnography","Methods: Archival & Document Analysis",
        "Methods: Digital Humanities & GIS/Mapping","Methods: Computational Social Science",
        "Methods: Quantitative/Statistics"
      ],
      "Language, Education & Society": [
        "Language Education & Pedagogy","Language Policy & Planning","Writing Systems & Literacy",
        "Sociolinguistics","Youth, Education & Student Life"
      ],
      "Media, Culture & Platforms": [
        "Media, Journalism & Public Opinion","Popular Culture & Media","Digital Culture & Platforms",
        "Arts, Literature & Aesthetics","Tourism, Heritage Routes & Creative Industries"
      ],
      "Business, Economy & Work": [
        "Business, Management & Work Culture","Economy & Development",
        "Trade, FDI & Supply Chains","Entrepreneurship & SMEs","Corporate Governance, CSR & ESG"
      ],
      "Politics, Law & IR": [
        "Law, Governance & Public Policy","International Relations & Security","Diplomacy, Soft Power & Cultural Exchange"
      ],
      "History, Heritage & Religion": [
        "History (Modern & Contemporary)","History (Pre-modern)","History & Heritage",
        "Memory, Heritage & Museums","Religion & Philosophy","Colonialism & Postcoloniality"
      ],
      "Technology, Data & Environment": [
        "Technology & Society","Technology, Innovation & Industry 4.0","AI, Data Governance & Privacy",
        "Environment, Climate & Energy Transitions","Urbanization, Housing & Infrastructure"
      ]
    };

    // ---------- Render interest chips ----------
    const groupsContainer = document.getElementById('interestGroups');
    const selectedInterests = new Set();

    function renderInterestChips(){
      groupsContainer.innerHTML = '';
      Object.entries(INTEREST_GROUPS).forEach(([group, items])=>{
        const head = document.createElement('div');
        head.className = 'row-head';
        head.textContent = group;
        groupsContainer.appendChild(head);

        const row = document.createElement('div');
        row.className = 'chip-row';
        items.forEach(tag=>{
          const b = document.createElement('button');
          b.className = 'chip';
          b.type = 'button';
          b.textContent = tag;
          b.setAttribute('aria-pressed','false');
          b.addEventListener('click', ()=> toggleInterest(b, tag));
          row.appendChild(b);
        });
        groupsContainer.appendChild(row);
      });
    }

    function toggleInterest(btn, tag){
      if(selectedInterests.has(tag)){
        selectedInterests.delete(tag);
      }else{
        selectedInterests.add(tag);
      }
      const on = selectedInterests.has(tag);
      btn.setAttribute('aria-pressed', on ? 'true' : 'false');
      btn.classList.toggle('selected', on);             // visual highlight
      scoreAndRender();
    }

    document.getElementById('clearAll').addEventListener('click', ()=>{
      selectedInterests.clear();
      document.querySelectorAll('button.chip').forEach(b=>{
        b.setAttribute('aria-pressed','false');
        b.classList.remove('selected');                 // clear highlight
      });
      scoreAndRender();
    });

    renderInterestChips();

    // ---------- Skills ----------
    const SKILL_LIST = [
      ['literature','Literature review'],
      ['qualitative','Qualitative methods'],
      ['quantitative','Quantitative/statistics'],
      ['coding','Coding / scripting'],
      ['fieldwork','Fieldwork / data collection'],
      ['writing','Academic writing'],
      ['language','CN/JP/KR language ability'],
      ['archival','Archival / document work'],
      ['dh','Digital humanities / GIS']
    ];

    const skillsHost = document.getElementById('skillsSliders');
    function renderSkills(){
      skillsHost.innerHTML = '';
      SKILL_LIST.forEach(([key,label])=>{
        const row = document.createElement('div');
        row.className = 'slider-row';
        row.innerHTML = `
          <label for="sk_${key}">${label}</label>
          <input id="sk_${key}" type="range" min="0" max="4" step="1" value="2" />
          <output id="out_${key}">2</output>
        `;
        const range = row.querySelector('input');
        const out = row.querySelector('output');
        range.addEventListener('input', ()=>{ out.textContent = range.value; scoreAndRender(); });
        skillsHost.appendChild(row);
      });
    }
    renderSkills();

    // constraints outputs
    const timeRange = document.getElementById('timeAvail');
    const timeOut = document.getElementById('timeOut');
    timeRange.addEventListener('input', ()=>{ timeOut.textContent = timeRange.value; scoreAndRender(); });
    document.getElementById('travelOk').addEventListener('change', scoreAndRender);
    document.getElementById('ethicsOk').addEventListener('change', scoreAndRender);

    // ---------- Fetch topics ----------
    let TOPICS = [];
    async function loadTopics(){
      try{
        const res = await fetch('topics.json', { cache: 'no-store' });
        if(!res.ok) throw new Error('Cannot load topics.json');
        TOPICS = await res.json();
      }catch(err){
        console.error(err);
        document.getElementById('results').innerHTML = `
          <div class="panel" style="border-style:dashed">
            <strong>Couldn’t load <code>topics.json</code>.</strong>
            <div class="muted small" style="margin-top:6px">Ensure the file exists in the same folder as this index and is valid JSON.</div>
          </div>`;
      }
      scoreAndRender();
    }
    loadTopics();

    // ---------- Scoring ----------
    function interestScore(tags){
      if(selectedInterests.size === 0) return 50; // neutral when nothing picked
      const overlap = tags.filter(t => selectedInterests.has(t)).length;
      const base = (overlap / Math.max(tags.length, 3)) * 100;
      // small bonus for picking any of the topic's method tags
      const methodHit = tags.some(t => t.startsWith('Methods:') && selectedInterests.has(t));
      return Math.min(100, base + (methodHit ? 8 : 0));
    }

    function capabilityScore(skillsNeeded){
      let diffs = [];
      SKILL_LIST.forEach(([key])=>{
        const user = Number(document.getElementById('sk_'+key).value);
        const req  = (skillsNeeded && Number.isFinite(skillsNeeded[key])) ? skillsNeeded[key] : 0;
        diffs.push(Math.abs(user - req) / 4); // normalize 0–1
      });
      const avgGap = diffs.reduce((a,b)=>a+b,0) / diffs.length;
      return Math.max(0, 100 * (1 - avgGap));
    }

    function constraintsScore(needs, timeDemand){
      const timeAvail = Number(timeRange.value);
      const travel = document.getElementById('travelOk').checked;
      const ethics = document.getElementById('ethicsOk').checked;
      let score = 100;

      // time penalty
      if(timeAvail < (timeDemand || 3)){
        const gap = (timeDemand || 3) - timeAvail;      // 0..3
        score -= gap * 18;                              // each step ~18 points
      }
      // travel / ethics
      if(needs && needs.travel && !travel) score -= 22;
      if(needs && needs.ethics && !ethics) score -= 18;

      return Math.max(0, Math.min(100, score));
    }

    function finalScore(intS, capS, conS){
      // weights: interests 0.45, capability 0.35, constraints 0.20
      return 0.45*intS + 0.35*capS + 0.20*conS;
    }

    // NEW: concise one-sentence suitability line (as requested)
    function suitabilityLine(score) {
      const s = Math.round(score.finalScore);
      const interestPart = score.interestScore >= 80
        ? "matches your interests very well"
        : score.interestScore >= 50
        ? "partially matches your interests"
        : "has limited overlap with your interests";

      const skillPart = score.capabilityScore >= 80
        ? "your current skills are well aligned"
        : score.capabilityScore >= 50
        ? "you may need to polish some key skills"
        : "you will need significant upskilling";

      const feasibilityPart = score.constraintsScore >= 80
        ? "and it is feasible within your time and access"
        : score.constraintsScore >= 50
        ? "and it is likely feasible with careful planning"
        : "and it will require more time or access to be feasible";

      return `Overall fit ${s}/100 — this topic ${interestPart}; ${skillPart}, ${feasibilityPart}.`;
    }

    // ---------- Render results ----------
    function scoreAndRender(){
      if(!TOPICS || TOPICS.length === 0){
        document.getElementById('results').innerHTML = '';
        return;
      }
      const scored = TOPICS.map(t=>{
        const i = interestScore(t.tags || []);
        const c = capabilityScore(t.skills || {});
        const k = constraintsScore(t.needs || {}, t.timeDemand);
        return { topic: t, interestScore:i, capabilityScore:c, constraintsScore:k, finalScore: finalScore(i,c,k) };
      }).sort((a,b)=> b.finalScore - a.finalScore);

      const frag = document.createDocumentFragment();

      scored.slice(0, 18).forEach((s, idx)=>{
        const card = document.createElement('div');
        card.className = 'panel';

        const head = document.createElement('div');
        head.className = 'result';
        head.innerHTML = `
          <h2>${idx+1}. ${escapeHtml(s.topic.title)}</h2>
          <div class="score" title="Overall fit score">${Math.round(s.finalScore)}</div>
        `;
        card.appendChild(head);

        if(s.topic.description){
          const p = document.createElement('p');
          p.style.margin = '4px 0 8px';
          p.textContent = s.topic.description;
          card.appendChild(p);
        }

        // tags
        if(Array.isArray(s.topic.tags) && s.topic.tags.length){
          const tags = document.createElement('div');
          tags.className = 'tags';
          s.topic.tags.forEach(t=>{
            const span = document.createElement('span');
            span.className = 'tag';
            span.textContent = t;
            tags.appendChild(span);
          });
          card.appendChild(tags);
        }

        // bars
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div>
            <div class="muted small" style="margin-bottom:6px">Interests</div>
            <div class="bar"><span style="width:${s.interestScore.toFixed(0)}%"></span></div>
            <div class="muted small" style="margin-top:6px">${s.interestScore.toFixed(0)} / 100</div>
          </div>
          <div>
            <div class="muted small" style="margin-bottom:6px">Capabilities</div>
            <div class="bar"><span style="width:${s.capabilityScore.toFixed(0)}%"></span></div>
            <div class="muted small" style="margin-top:6px">${s.capabilityScore.toFixed(0)} / 100</div>
          </div>
          <div>
            <div class="muted small" style="margin-bottom:6px">Constraints</div>
            <div class="bar"><span style="width:${s.constraintsScore.toFixed(0)}%"></span></div>
            <div class="muted small" style="margin-top:6px">${s.constraintsScore.toFixed(0)} / 100</div>
          </div>
        `;
        card.appendChild(row);

        // suitability line
        const suit = document.createElement('div');
        suit.className = 'suit-line';
        suit.style.marginTop = '12px';
        suit.textContent = suitabilityLine(s);
        card.appendChild(suit);

        frag.appendChild(card);
      });

      const results = document.getElementById('results');
      results.innerHTML = '';
      results.appendChild(frag);
    }

    // ---------- Helpers ----------
    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
        .replaceAll('"','&quot;').replaceAll("'","&#039;");
    }
  </script>
</body>
</html>
